<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabalƒ± ƒ∞≈üe Gidi≈ü Takip Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .current-driver {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .current-driver .driver-name {
            font-size: 2.5em;
            color: #667eea;
            font-weight: bold;
            margin: 10px 0;
        }

        .current-driver .week-info {
            color: #666;
            font-size: 1.1em;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .user-list {
            list-style: none;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .user-item:hover {
            background: #e9ecef;
        }

        .user-item .user-name {
            font-weight: 600;
            color: #333;
        }

        .user-item .user-actions {
            display: flex;
            gap: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .close-btn:hover {
            color: #333;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section h4 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .driver-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .driver-option {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            color: #667eea;
        }

        .driver-option:hover {
            background: #667eea;
            color: white;
        }

        .driver-option.selected {
            background: #667eea;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .week-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .week-nav button {
            padding: 10px 20px;
            font-size: 1.2em;
        }

        .week-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 600px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Arabalƒ± ƒ∞≈üe Gidi≈ü Takip Sistemi</h1>
        
        <div id="statusMessage" class="status-message"></div>

        <div class="card">
            <h2>Bu Haftanƒ±n S√ºr√ºc√ºs√º</h2>
            <div id="currentDriverSection" class="loading">
                <div class="loading-spinner">‚è≥</div>
                <p>Y√ºkleniyor...</p>
            </div>
            <div id="driverChangeSection" style="display: none;">
                <div class="week-nav">
                    <button class="btn btn-secondary" onclick="changeWeek(-1)">‚óÄ √ñnceki</button>
                    <span class="week-number" id="weekNumberDisplay">Hafta 1</span>
                    <button class="btn btn-secondary" onclick="changeWeek(1)">Sonraki ‚ñ∂</button>
                </div>
                <div class="current-driver">
                    <p>Bu haftanƒ±n s√ºr√ºc√ºs√º:</p>
                    <div class="driver-name" id="currentDriverName">Y√ºkleniyor...</div>
                    <div class="week-info" id="weekInfo">Y√ºkleniyor...</div>
                </div>
                <p>S√ºr√ºc√ºy√º deƒüi≈ütir:</p>
                <div id="driverSelector" class="driver-selector"></div>
            </div>
        </div>

        <div class="card">
            <h2>Kullanƒ±cƒ±lar</h2>
            <ul id="userList" class="user-list">
                <li class="loading">Y√ºkleniyor...</li>
            </ul>
            <button class="btn btn-primary" onclick="openAddUserModal()">+ Yeni Kullanƒ±cƒ± Ekle</button>
        </div>

        <div class="card">
            <h2>Bot Ayarlarƒ±</h2>
            <button class="btn btn-primary" onclick="openSettingsModal()">‚öôÔ∏è Ayarlar</button>
            <button class="btn btn-success" onclick="testBot()">üîó Bot Baƒülantƒ±sƒ±nƒ± Test Et</button>
            <button class="btn btn-secondary" onclick="sendReminder()">üì§ Test Mesajƒ± G√∂nder</button>
        </div>
    </div>

    <!-- Kullanƒ±cƒ± Ekleme/D√ºzenleme Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Yeni Kullanƒ±cƒ± Ekle</h3>
                <button class="close-btn" onclick="closeUserModal()">&times;</button>
            </div>
            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label for="userName">ƒ∞sim:</label>
                    <input type="text" id="userName" required placeholder="Ki≈üinin adƒ±nƒ± girin">
                </div>
                <button type="submit" class="btn btn-primary">Kaydet</button>
                <button type="button" class="btn btn-secondary" onclick="closeUserModal()">ƒ∞ptal</button>
            </form>
        </div>
    </div>

    <!-- Ayarlar Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Ayarlar</h3>
                <button class="close-btn" onclick="closeSettingsModal()">&times;</button>
            </div>
            <form id="settingsForm" onsubmit="saveSettings(event)">
                <div class="settings-section">
                    <h4>Telegram Bot Ayarlarƒ±</h4>
                    <div class="form-group">
                        <label for="botToken">Bot Token:</label>
                        <input type="text" id="botToken" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11">
                    </div>
                    <div class="form-group">
                        <label for="chatId">Grup Chat ID:</label>
                        <input type="text" id="chatId" placeholder="-100123456789">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Hatƒ±rlatma Zamanƒ±</h4>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label for="reminderDay">Hatƒ±rlatma G√ºn√º:</label>
                            <select id="reminderDay">
                                <option value="0">Pazar</option>
                                <option value="1">Pazartesi</option>
                                <option value="2">Salƒ±</option>
                                <option value="3">√áar≈üamba</option>
                                <option value="4">Per≈üembe</option>
                                <option value="5">Cuma</option>
                                <option value="6">Cumartesi</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reminderHour">Hatƒ±rlatma Saati:</label>
                            <select id="reminderHour">
                                <script>
                                    for (let i = 0; i < 24; i++) {
                                        document.write(`<option value="${i}">${i.toString().padStart(2, '0')}:00</option>`);
                                    }
                                </script>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reminderMinute">Hatƒ±rlatma Dakikasƒ±:</label>
                            <select id="reminderMinute">
                                <script>
                                    for (let i = 0; i < 60; i += 5) {
                                        document.write(`<option value="${i}">${i.toString().padStart(2, '0')}</option>`);
                                    }
                                </script>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Rotasyon Ba≈ülangƒ±cƒ±</h4>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label for="rotationStartYear">Ba≈ülangƒ±√ß Yƒ±lƒ±:</label>
                            <input type="number" id="rotationStartYear" min="2020" max="2100">
                        </div>
                        <div class="form-group">
                            <label for="rotationStartWeek">Ba≈ülangƒ±√ß Haftasƒ±:</label>
                            <input type="number" id="rotationStartWeek" min="1" max="53">
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="submit" class="btn btn-success">üíæ Ayarlarƒ± Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let settings = {
            botToken: '',
            chatId: '',
            reminderDay: 5,
            reminderHour: 18,
            reminderMinute: 0,
            users: [],
            rotationStartWeek: 1,
            rotationStartYear: 2025
        };

        let currentWeekOffset = 0;
        let currentYear = new Date().getFullYear();
        let currentWeekNum = getWeekNumber(new Date());

        // API Base URL
        const API_BASE = '/api';

        // API fonksiyonlarƒ±
        async function apiGet(endpoint) {
            const response = await fetch(`${API_BASE}${endpoint}`);
            if (!response.ok) {
                throw new Error(`API hatasƒ±: ${response.status}`);
            }
            return response.json();
        }

        async function apiPost(endpoint, data) {
            const response = await fetch(`${API_BASE}${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || `API hatasƒ±: ${response.status}`);
            }
            return response.json();
        }

        // Hafta numarasƒ±nƒ± hesapla
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Tarih formatla
        function formatDate(date) {
            return date.toLocaleDateString('tr-TR', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // Haftanƒ±n ba≈ülangƒ±√ß ve biti≈ü tarihini hesapla
        function getWeekDates(weekNum, year) {
            const simple = new Date(Date.UTC(year, 0, 1 + (weekNum - 1) * 7));
            const dow = simple.getDay();
            const weekStart = simple;
            if (dow <= 4) {
                weekStart.setDate(simple.getDate() - simple.getDay() + 1);
            } else {
                weekStart.setDate(simple.getDate() + 8 - simple.getDay());
            }
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            return { start: weekStart, end: weekEnd };
        }

        // O anki haftanƒ±n s√ºr√ºc√ºs√ºn√º hesapla
        function getCurrentDriver(weekNum, year) {
            if (settings.users.length === 0) return { name: 'Kullanƒ±cƒ± yok', index: -1 };

            const baseWeek = settings.rotationStartWeek || 1;
            const baseYear = settings.rotationStartYear || year;
            
            // Basit hafta hesaplama
            let effectiveWeek = (weekNum - baseWeek);
            if (year > baseYear) {
                effectiveWeek += (year - baseYear) * 52;
            }
            
            // Negatif hafta kontrol√º
            while (effectiveWeek < 0) {
                effectiveWeek += settings.users.length;
            }

            const driverIndex = effectiveWeek % settings.users.length;
            return { 
                name: settings.users[driverIndex].name, 
                index: driverIndex,
                weekNum: weekNum,
                year: year
            };
        }

        // S√ºr√ºc√ºy√º deƒüi≈ütir
        async function changeDriver(newIndex) {
            if (settings.users.length === 0) {
                showStatus('√ñnce kullanƒ±cƒ± eklemelisiniz!', 'error');
                return;
            }

            const targetWeek = currentWeekNum + currentWeekOffset;
            const current = getCurrentDriver(targetWeek, currentYear);

            if (current.index === -1) {
                showStatus('S√ºr√ºc√º atanamadƒ±!', 'error');
                return;
            }

            // Kullanƒ±cƒ±nƒ±n sƒ±rasƒ±nƒ± deƒüi≈ütir
            const driverName = settings.users[current.index].name;
            const newDriverName = settings.users[newIndex].name;
            
            // S√ºr√ºc√ºy√º en ba≈üa alarak rotasyonu deƒüi≈ütir
            const userToMove = settings.users.splice(current.index, 1)[0];
            settings.users.unshift(userToMove);

            // Rotasyon ba≈ülangƒ±cƒ±nƒ± g√ºncelle
            const baseWeek = settings.rotationStartWeek || 1;
            settings.rotationStartWeek = targetWeek;

            try {
                await apiPost('/settings', settings);
                showStatus(`${driverName} yerine ${newDriverName} bu haftanƒ±n s√ºr√ºc√ºs√º olarak ayarlandƒ±!`, 'success');
                loadSettings();
            } catch (error) {
                showStatus('Hata: ' + error.message, 'error');
            }
        }

        // Hafta deƒüi≈ütir
        function changeWeek(delta) {
            currentWeekOffset += delta;
            updateDriverDisplay();
        }

        // S√ºr√ºc√º ekranƒ±nƒ± g√ºncelle
        function updateDriverDisplay() {
            const targetWeek = currentWeekNum + currentWeekOffset;
            const weekDates = getWeekDates(targetWeek, currentYear);
            
            document.getElementById('weekNumberDisplay').textContent = `Hafta ${targetWeek} (${currentYear})`;
            document.getElementById('weekInfo').textContent = `${formatDate(weekDates.start)} - ${formatDate(weekDates.end)}`;
            
            const driver = getCurrentDriver(targetWeek, currentYear);
            document.getElementById('currentDriverName').textContent = driver.name;
            
            // S√ºr√ºc√º se√ßiciyi g√ºncelle
            const selector = document.getElementById('driverSelector');
            selector.innerHTML = '';
            
            if (settings.users.length > 0) {
                settings.users.forEach((user, index) => {
                    const btn = document.createElement('div');
                    btn.className = 'driver-option' + (user.name === driver.name ? ' selected' : '');
                    btn.textContent = user.name;
                    btn.onclick = () => changeDriver(index);
                    selector.appendChild(btn);
                });
            }
        }

        // Ayarlarƒ± y√ºkle
        async function loadSettings() {
            try {
                settings = await apiGet('/settings');
                updateUserList();
                updateDriverDisplay();
            } catch (error) {
                showStatus('Ayarlar y√ºklenemedi: ' + error.message, 'error');
            }
        }

        // Kullanƒ±cƒ± listesini g√ºncelle
        function updateUserList() {
            const userList = document.getElementById('userList');
            
            if (settings.users.length === 0) {
                userList.innerHTML = '<li class="loading">Kullanƒ±cƒ± yok. Yukarƒ±dan kullanƒ±cƒ± ekleyin.</li>';
                return;
            }

            userList.innerHTML = settings.users.map((user, index) => `
                <li class="user-item">
                    <span class="user-name">${index + 1}. ${user.name}</span>
                    <div class="user-actions">
                        <button class="btn btn-secondary btn-sm" onclick="editUser(${index})">D√ºzenle</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${index})">Sil</button>
                    </div>
                </li>
            `).join('');
        }

        // Kullanƒ±cƒ± modalƒ±nƒ± a√ß
        function openAddUserModal() {
            document.getElementById('userModalTitle').textContent = 'Yeni Kullanƒ±cƒ± Ekle';
            document.getElementById('userId').value = '';
            document.getElementById('userName').value = '';
            document.getElementById('userModal').classList.add('active');
        }

        // Kullanƒ±cƒ±yƒ± d√ºzenle
        function editUser(index) {
            const user = settings.users[index];
            document.getElementById('userModalTitle').textContent = 'Kullanƒ±cƒ±yƒ± D√ºzenle';
            document.getElementById('userId').value = index;
            document.getElementById('userName').value = user.name;
            document.getElementById('userModal').classList.add('active');
        }

        // Kullanƒ±cƒ± modalƒ±nƒ± kapat
        function closeUserModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        // Kullanƒ±cƒ±yƒ± kaydet
        async function saveUser(event) {
            event.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const userName = document.getElementById('userName').value.trim();
            
            if (!userName) {
                showStatus('L√ºtfen isim girin!', 'error');
                return;
            }

            try {
                if (userId === '') {
                    // Yeni kullanƒ±cƒ± ekle
                    settings.users.push({ name: userName });
                    showStatus(`${userName} eklendi!`, 'success');
                } else {
                    // Mevcut kullanƒ±cƒ±yƒ± g√ºncelle
                    const oldName = settings.users[userId].name;
                    settings.users[userId].name = userName;
                    showStatus(`${oldName} g√ºncellendi!`, 'success');
                }
                
                await apiPost('/settings', settings);
                closeUserModal();
                loadSettings();
            } catch (error) {
                showStatus('Hata: ' + error.message, 'error');
            }
        }

        // Kullanƒ±cƒ±yƒ± sil
        async function deleteUser(index) {
            if (!confirm(`${settings.users[index].name} silinsin mi?`)) return;
            
            const deletedName = settings.users[index].name;
            settings.users.splice(index, 1);
            
            try {
                await apiPost('/settings', settings);
                showStatus(`${deletedName} silindi!`, 'success');
                loadSettings();
            } catch (error) {
                showStatus('Hata: ' + error.message, 'error');
            }
        }

        // Ayarlar modalƒ±nƒ± a√ß
        function openSettingsModal() {
            document.getElementById('botToken').value = settings.botToken || '';
            document.getElementById('chatId').value = settings.chatId || '';
            document.getElementById('reminderDay').value = settings.reminderDay || 5;
            document.getElementById('reminderHour').value = settings.reminderHour || 18;
            document.getElementById('reminderMinute').value = settings.reminderMinute || 0;
            document.getElementById('rotationStartYear').value = settings.rotationStartYear || currentYear;
            document.getElementById('rotationStartWeek').value = settings.rotationStartWeek || currentWeekNum;
            document.getElementById('settingsModal').classList.add('active');
        }

        // Ayarlar modalƒ±nƒ± kapat
        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // Ayarlarƒ± kaydet
        async function saveSettings(event) {
            event.preventDefault();
            
            settings.botToken = document.getElementById('botToken').value.trim();
            settings.chatId = document.getElementById('chatId').value.trim();
            settings.reminderDay = parseInt(document.getElementById('reminderDay').value);
            settings.reminderHour = parseInt(document.getElementById('reminderHour').value);
            settings.reminderMinute = parseInt(document.getElementById('reminderMinute').value);
            settings.rotationStartYear = parseInt(document.getElementById('rotationStartYear').value);
            settings.rotationStartWeek = parseInt(document.getElementById('rotationStartWeek').value);

            try {
                const result = await apiPost('/settings', settings);
                showStatus('Ayarlar ba≈üarƒ±yla kaydedildi!', 'success');
                closeSettingsModal();
                loadSettings();
            } catch (error) {
                showStatus('Hata: ' + error.message, 'error');
            }
        }

        // Bot baƒülantƒ±sƒ±nƒ± test et
        async function testBot() {
            const botToken = document.getElementById('botToken')?.value || settings.botToken;
            const chatId = document.getElementById('chatId')?.value || settings.chatId;

            if (!botToken || !chatId) {
                showStatus('L√ºtfen √∂nce Bot Token ve Chat ID ayarlarƒ±nƒ± girin!', 'error');
                openSettingsModal();
                return;
            }

            try {
                const result = await apiPost('/test-bot', { botToken, chatId });
                showStatus(`‚úÖ ${result.message} (Bot: @${result.botName})`, 'success');
            } catch (error) {
                showStatus('‚ùå ' + error.message, 'error');
            }
        }

        // Hatƒ±rlatma mesajƒ± g√∂nder
        async function sendReminder() {
            const botToken = document.getElementById('botToken')?.value || settings.botToken;
            const chatId = document.getElementById('chatId')?.value || settings.chatId;

            if (!botToken || !chatId) {
                showStatus('L√ºtfen √∂nce Bot Token ve Chat ID ayarlarƒ±nƒ± girin!', 'error');
                openSettingsModal();
                return;
            }

            const driver = getCurrentDriver(currentWeekNum, currentYear);
            const weekDates = getWeekDates(currentWeekNum, currentYear);
            const message = `üöó *Bu Haftanƒ±n S√ºr√ºc√ºs√º*\n\n` +
                `üìÖ *Tarih:* ${formatDate(weekDates.start)} - ${formatDate(weekDates.end)}\n` +
                `üë§ *S√ºr√ºc√º:* ${driver.name}\n\n` +
                `_Not: Arabalƒ± i≈üe gidi≈ü sistemi ile hazƒ±rlanmƒ±≈ütƒ±r._`;

            try {
                const result = await apiPost('/send-message', {
                    botToken,
                    chatId,
                    message
                });
                showStatus('‚úÖ Test mesajƒ± ba≈üarƒ±yla g√∂nderildi!', 'success');
            } catch (error) {
                showStatus('‚ùå ' + error.message, 'error');
            }
        }

        // Durum mesajƒ± g√∂ster
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            setTimeout(() => {
                statusEl.className = 'status-message';
            }, 5000);
        }

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('currentDriverSection').style.display = 'none';
            document.getElementById('driverChangeSection').style.display = 'block';
            
            await loadSettings();
        });
    </script>
</body>
</html>
